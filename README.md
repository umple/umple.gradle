# umple.gradle.plugin

**Tasks:**

  - compile{source set name}Umple

**Instructions:**
The plugin has four configuration properties that are used to customize the `compile{source set name}Umple` task.
  - language: The language(s) you want to compile your Umple files to. You can specify a single language or multiple languages.
  - master: The name of your master Umple file. The plugin looks for this file in the following location: `{project root directory}/src/{source set name}/umple. Multiple master files may be specified.
  - customMasterPath: If you want the plugin to look for a master file in a location that doesn't conform to the `{project root directory}/src/{source set name}/umple` convention, set this flag to true and provide a path to the master file starting from the project root directory of the project that contains the `master` file you want to use
  - compileGenerated: A flag that tells the plugin whether or not you want the generated source files to be compiled. Currently, the plugin only supports compiling Java files.
  - outputDir: The location you want the generated source files outputted to. This is relative to your project's root directory. The plugin will automatically look in this 
  location if you tell it to compile generated files.
    
These values are set in the `build.gradle` file of the project you're applying the plugin to. If any required fields are not set, the plugin will fall back on the following default values:

language = ['Java']
outputDir = 'generated'
master = ['Master.ump']
compileGenerated = true
customMasterFlag = false

You can also specify global default values that apply to all `SourceSets` present in your build. Global defaults override the system defaults described above, but will not 
override any SourceSet specific configuration values you provide. 

Consider a project that uses the `main` source set (i.e. the source set added by the Java plugin). If you set the `outputDir` value of the `compileUmple` task for this source set to `/src/custom/path/generated/`, this value takes precedence over any global or system default values. Even if you specify a global default value for `outputDir`, the specific value provided for the `main` source set will apply to the `compileUmple` task. Note that `compileUmple` is the task added to your project by the plugin to compile Umple files from the `main` sourceset. Because `main` is a default `SourceSet`, we don't need to add it's name the the compile Umple task.

Here's what a build script based on our example might look like:
  

```
apply plugin: 'java'
sourceSets {
    main { 
        umple {
            language = 'Java'
            outputDir = file('src/custom/java/')
            master = file('master.ump')
            compileGenerated = false
        }
    }
    generatedPhp {
        language = 'Php'
    }
}

umple {
      master = file('master_main.ump')
      outputDir = file('src/custom/path/generated')
 }   
```

We've specified three `SourceSet`-specific configuration options for the `main` `SourceSet`. These configuration values have the highest priority, and therefore will be used by the plugin when `compileUmple` is called. Notice that the `compileGenerated` flag is set to false, so we won't automatically compile the source files generated by the `compileUmple` task. 

On the other hand, we've only provided a `language` value for the `generatedPhp` `SourceSet`. To determine the values to use for the the other three values, the Umple plugin first looks to the global defaults we've provided. It gets a value for `master` and `outputDir` from this source. However, we haven't specified a configuration value for `compileGenerated` in our global defaults. Since neither `generatedPhp` nor the global defaults have specified a value for `compileGenerated`, we fall back on the system default value, which, as mentioned earlier, is `true`.

For a more complete example, see the `Base project` directory in the Gradle plugin's Github repo (https://github.com/umple/umple.gradle)

The [Umple Compiler Jar](https://github.com/umple/Umple/releases/latest/) must also be present on your local machine and referenced as a buildscript dependency in the `build.gradle` file of the project that is applying the gradle plugin. You can use the snippet below as a template:

**Buildscript**
```
buildscript {
    repositories {
        maven {
      	  url "https://plugins.gradle.org/m2/"
    	}
        maven {
          url uri('libs')
        }
    }
    dependencies {
		classpath files('libs/umple-latest.jar')
		classpath group: 'cruise.umple', name: 'UmpleGradlePlugin',  version: '0.1.3'
    }
}
apply plugin: 'umple.gradle.plugin'
```

Here, the `libs` folder is relative to your project's root folder (i.e. the folder that contains your project's `build.gradle` file).  

**Recommendations**
To keep the Umple Jar up-to-date automatically through Gradle, I recommend the `download` plugin:
```
apply plugin: 'de.undercouch.download'

import de.undercouch.gradle.tasks.download.Download

// downloads the umple jar only if the online version is newer
task downloadUmpleJar(type: de.undercouch.gradle.tasks.download.Download) {
    onlyIfNewer true
    overwrite true
    src 'http://cruise.eecs.uottawa.ca/umpleonline/scripts/umple.jar'
    dest 'libs/umple-latest.jar'

}

generateSource.dependsOn('downloadUmpleJar')
```
You'll also need to add 'classpath `de.undercouch:gradle-download-task:3.1.2'` to your `buildscript` dependencies closure if you want to use the download task. 

